import{D as w}from"./DashboardSwitch.dc169bb3.js";import{D as C}from"./DashboardWarning.95ccc3d6.js";import{_ as y}from"./app.f6b791b5.js";import{e as l,f as d,A as a,D as v,F as p,g as u,j as g,C as b,s as k,v as h,i as S,x as D,Q as f,N as P,O as x}from"./@vue.ca773235.js";import{w as R}from"./pageSidebar.9e81cee6.js";import"./vue.9ea8e8a6.js";import"./vuex.497f08d2.js";import"./overlayscrollbars.8d928870.js";import"./apexcharts.8dc8f2aa.js";import"./string-similarity.860833b6.js";import"./gsap.8449ad8c.js";import"./vue-router.63e2ccab.js";import"./vuex-persistedstate.fa252374.js";import"./izitoast.765d8918.js";import"./click-outside-vue3.6791b41e.js";import"./floating-vue.8db45bbf.js";import"./@floating-ui.9bdab495.js";import"./axios.ea6880df.js";import"./@vuepic.b319e7e5.js";import"./date-fns.5b6f9246.js";const N={data(){return{edit:!1}},methods:{hasPermission(o,t,i){let c=!1;return this.role.permissions.forEach(r=>{r.id===t&&(c=r.permissions[i])}),c},togglePermission(o,t){const i=this.permissions.filter(e=>e.id===o)[0];let c=this.role.permissions;const r=(e,m,n,s)=>{window.axios.post("/admin/roles/update",{roleId:e,permissionId:m,type:n,state:s}).catch(()=>this.$toast.error("Failed to update role permissions"))};if(c.filter(e=>e.id===o)[0]){const e=c.filter(m=>m.id===o)[0];e.permissions[t]=!e.permissions[t],r(this.role.id,e.id,t,e.permissions[t])}else{let e=JSON.parse(JSON.stringify(i));e.permissions[t]=!e.permissions[t],c.push(e),r(this.role.id,e.id,t,e.permissions[t])}this.roleUpdate(c)},removeRole(o){confirm("Are you sure?")&&window.axios.post("/admin/roles/remove",{id:o}).then(()=>this.$router.go())},save(){this.edit=!1}},components:{DashboardWarning:C,DashboardSwitch:w},props:["role","permissions","roleUpdate"]},_=o=>(P("data-v-8e364c8e"),o=o(),x(),o),B={class:"role"},I={class:"roleTitle"},O={class:"name"},V={class:"description"},E={class:"type"},T=_(()=>a("div",null,"Allow",-1)),A={key:0,class:"type"},F=_(()=>a("div",null,"Edit",-1)),J={key:1,class:"type"},U=_(()=>a("div",null,"Create",-1)),j={key:2,class:"type"},z=_(()=>a("div",null,"Delete",-1));function L(o,t,i,c,r,e){const m=f("dashboard-warning"),n=f("dashboard-switch");return l(),d("div",B,[a("div",I,v(i.role.name),1),i.role.readOnly?(l(),d(p,{key:0},[u(m,{type:"info"},{default:g(()=>[b(" This role can't be edited or removed. ")]),_:1}),i.role.id==="chat_moderator"?(l(),k(m,{key:0,type:"info"},{default:g(()=>[b(" This role enables blue border for user's chat messages and ability to moderate chat messages. ")]),_:1})):h("",!0)],64)):(l(!0),d(p,{key:1},S(i.permissions,s=>(l(),d(p,null,[s.id!=="*"?(l(),d("div",{class:"permission",key:i.role.id+s},[a("div",O,v(s.name),1),a("div",V,v(s.description),1),a("div",E,[a("div",null,[u(n,{value:e.hasPermission(i.role,s.id,"active"),onChange:()=>e.togglePermission(s.id,"active")},null,8,["value","onChange"])]),T]),s.isEditable?(l(),d("div",A,[a("div",null,[u(n,{value:e.hasPermission(i.role,s.id,"edit"),onChange:()=>e.togglePermission(s.id,"edit")},null,8,["value","onChange"])]),F])):h("",!0),s.isCreatable?(l(),d("div",J,[a("div",null,[u(n,{value:e.hasPermission(i.role,s.id,"create"),onChange:()=>e.togglePermission(s.id,"create")},null,8,["value","onChange"])]),U])):h("",!0),s.isDeletable?(l(),d("div",j,[a("div",null,[u(n,{value:e.hasPermission(i.role,s.id,"delete"),onChange:()=>e.togglePermission(s.id,"delete")},null,8,["value","onChange"])]),z])):h("",!0)])):h("",!0)],64))),256)),i.role.readOnly?h("",!0):(l(),d("button",{key:2,class:D(["btn btn-primary removeRole",o.$isDemo?"demoDisable":""]),onClick:t[0]||(t[0]=s=>e.removeRole(i.role.id))},"Remove",2))])}const Q=y(N,[["render",L],["__scopeId","data-v-8e364c8e"]]),W={data(){return{roles:null,role:null}},created(){R(()=>{this.loadRoles(!0),this.$bus.$on("rolesSidebar:select",o=>{this.role=o}),this.$bus.$on("rolesSidebar:update",this.loadRoles)})},watch:{roles(){this.$bus.$emit("rolesSidebar:setData",this.roles)}},methods:{loadRoles(o=!1){this.roles=null,window.axios.post("/admin/roles/all").then(({data:t})=>{this.roles=t,this.$bus.$emit("loading:done"),o&&this.$bus.$emit("rolesSidebar:select",t.roles[0].id)})}},components:{RoleBlock:Q}},q={key:0,class:"roles animate"};function G(o,t,i,c,r,e){const m=f("role-block");return r.roles?(l(),d("div",q,[r.role?(l(),k(m,{key:0,role:r.roles.roles.filter(n=>n.id===r.role)[0],permissions:r.roles.allPermissions,"role-update":n=>n},null,8,["role","permissions","role-update"])):h("",!0)])):h("",!0)}const ue=y(W,[["render",G]]);export{ue as default};
