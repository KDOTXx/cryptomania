import{O as w}from"./overlayscrollbars.8d928870.js";import{_ as k,W as D}from"./app.f6b791b5.js";import{D as g}from"./DashboardDropdownConfig.00aa5cf0.js";import{f as n,A as t,v as a,F as p,C as c,i as C,s as x,j as S,x as b,g as v,Q as f,e as o,D as l,N as B,O as N}from"./@vue.ca773235.js";import"./apexcharts.8dc8f2aa.js";import"./vue.9ea8e8a6.js";import"./vuex.497f08d2.js";import"./string-similarity.860833b6.js";import"./gsap.8449ad8c.js";import"./vue-router.63e2ccab.js";import"./vuex-persistedstate.fa252374.js";import"./izitoast.765d8918.js";import"./click-outside-vue3.6791b41e.js";import"./floating-vue.8db45bbf.js";import"./@floating-ui.9bdab495.js";import"./axios.ea6880df.js";import"./@vuepic.b319e7e5.js";import"./date-fns.5b6f9246.js";import"./DashboardSwitch.dc169bb3.js";const U={data(){return{bonusbalance:null,currencies:null,isUnlimited:!1,isRandom:!1,code:"Code",uses:"50",sum:"0",currency:null,expires:new Date(Date.now()+3600*1e3*24)}},components:{WebIcon:D,DashboardDropdownConfig:g},methods:{remove(s){this.bonusbalance=this.bonusbalance.filter(d=>d._id!==s),window.axios.post("/admin/bonusbalance/remove",{id:s})},cleanup(){window.axios.post("/admin/bonusbalance/remove_inactive").then(()=>{this.$toast.success("Done"),this.load()})},create(){window.axios.post("/admin/bonusbalance/create",{code:this.isRandom?"%random%":this.code,usages:this.isUnlimited?"%infinite%":parseInt(this.uses),expires:new Date(this.expires).getTime()/1e3,sum:parseFloat(this.sum),currency:this.currency}).then(()=>this.load()).catch(()=>this.$toast.error("Error"))},load(s=!1){window.axios.post("/admin/bonusbalance/get").then(({data:d})=>{this.bonusbalance=d,s&&(this.$bus.$emit("loading:done"),this.$nextTick(()=>{w(document.querySelector(".bonusbalance .entries"),{scrollbars:{autoHide:"leave"},className:"os-theme-thin-light"})}))})}},created(){this.load(!0),window.axios.post("/api/data/currencies").then(({data:s})=>{this.currencies=s,this.currency=Object.keys(this.currencies)[0]})}},u=s=>(B("data-v-ed7d09f4"),s=s(),N(),s),I={key:0,class:"bonusbalance animate"},V={class:"entries"},O={class:"h"},E=u(()=>t("div",null,"Code",-1)),F=u(()=>t("div",null,"Amount",-1)),P=u(()=>t("div",null,"Usages",-1)),R=u(()=>t("div",null,"Expiration",-1)),j=u(()=>t("div",null,"Created",-1)),A={key:0},L={key:0},T=["onClick"],W={class:"buttons"};function $(s,d,q,z,i,m){const h=f("web-icon"),y=f("dashboard-dropdown-config");return i.bonusbalance?(o(),n("div",I,[t("div",V,[t("div",O,[E,F,P,R,j,s.$permission.checkPermission("bonusbalance","delete")?(o(),n("div",A,"Actions")):a("",!0)]),i.bonusbalance.length===0?(o(),n(p,{key:0},[c(" No data to show. ")],64)):a("",!0),(o(!0),n(p,null,C(i.bonusbalance,e=>(o(),n("div",{class:"entry",key:e},[t("div",null,l(e.code),1),t("div",null,[c(l(e.sum.toFixed(e.currency.startsWith("local_")?2:8))+" ",1),i.currencies?(o(),n(p,{key:0},[c(l(i.currencies[i.currency].name),1)],64)):a("",!0)]),t("div",null,[c(l(e.times_used),1),e.usages>=0?(o(),n(p,{key:0},[c("/"+l(e.usages),1)],64)):a("",!0)]),t("div",null,l(+new Date(e.expires)==-62135596800?"Never":new Date(e.expires).toLocaleString()),1),t("div",null,l(new Date(e.created_at).toLocaleString()),1),s.$permission.checkPermission("bonusbalance","delete")?(o(),n("div",L,[t("button",{class:b(["btn btn-primary",s.$isDemo?"demoDisable":""]),onClick:r=>m.remove(e._id)},[v(h,{icon:"fal fa-fw fa-times"}),c(" Delete ")],10,T)])):a("",!0)]))),128))]),t("div",W,[s.$permission.checkPermission("bonusbalance","create")&&i.currencies?(o(),x(y,{key:0,values:[{type:"switch",title:"Unlimited",event:(e,r)=>{this.isUnlimited=e,e?r.disabled.push("Uses"):r.disabled=r.disabled.filter(_=>_!=="Uses")}},{type:"switch",title:"Random code",event:(e,r)=>{this.isRandom=e,e?r.disabled.push("Code"):r.disabled=r.disabled.filter(_=>_!=="Code")}},{type:"input",title:"Code",value:this.code,event:e=>{this.code=e}},{type:"input",title:"Uses",value:this.uses,event:e=>{this.uses=e}},{type:"input",title:"Sum",value:this.sum,event:e=>{this.sum=e}},{type:"select",title:"Currency",value:this.currency,values:Object.keys(i.currencies).map(e=>[i.currencies[e].id,i.currencies[e].name]),event:e=>{this.currency=e}},{type:"datepicker",value:i.expires,title:"Expires",event:e=>{this.expires=new Date(e)}},{type:"button",disabled:s.$isDemo,title:"Create",event:e=>{e.show=!1,m.create()}}]},{default:S(()=>[v(h,{icon:"fal fa-fw fa-plus"}),c(" Create ")]),_:1},8,["values"])):a("",!0),s.$permission.checkPermission("bonusbalance","delete")?(o(),n("button",{key:1,class:b(["btn",s.$isDemo?"demoDisable":""]),onClick:d[0]||(d[0]=(...e)=>m.cleanup&&m.cleanup(...e))},[v(h,{icon:"fal fa-fw fa-times"}),c(" Delete expired")],2)):a("",!0)])])):a("",!0)}const de=k(U,[["render",$],["__scopeId","data-v-ed7d09f4"]]);export{de as default};
