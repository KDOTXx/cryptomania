import{b as V}from"./codemirror.613ad510.js";import{z as A,E as $,p as F,A as N,F as G,B as H,C as O}from"./@codemirror.0312c085.js";import{w as q}from"./pageSidebar.9e81cee6.js";import{W as P,_ as W}from"./app.f6b791b5.js";import{m as z}from"./vuex.497f08d2.js";import{i as g}from"./@jaames.ca058c90.js";import{e as d,f as m,A as i,D as _,F as f,g as C,I as x,B as b,a4 as L,x as R,Q as T,a3 as S,C as v,i as k,v as w,s as D,N as Z,O as j}from"./@vue.ca773235.js";import{_ as E}from"./CompilerModalOutput.6f9ec5f7.js";import{_ as B}from"./LoadingModal.a415cab1.js";import"./@lezer.5b9aa3da.js";import"./crelt.67277586.js";import"./style-mod.a2e40363.js";import"./w3c-keyname.30cf5eb3.js";import"./vue.9ea8e8a6.js";import"./overlayscrollbars.8d928870.js";import"./apexcharts.8dc8f2aa.js";import"./string-similarity.860833b6.js";import"./gsap.8449ad8c.js";import"./vue-router.63e2ccab.js";import"./vuex-persistedstate.fa252374.js";import"./izitoast.765d8918.js";import"./click-outside-vue3.6791b41e.js";import"./floating-vue.8db45bbf.js";import"./@floating-ui.9bdab495.js";import"./axios.ea6880df.js";import"./@vuepic.b319e7e5.js";import"./date-fns.5b6f9246.js";import"./LoaderAnimation.f430cb8d.js";const M={data(){return{showPicker:!1,color:this.value,alpha:1,iro:null}},props:["name","value","onChange"],computed:{isHex(){return/^#[0-9a-fA-F]{8}$|#[0-9a-fA-F]{6}$|#[0-9a-fA-F]{4}$|#[0-9a-fA-F]{3}$/i.test(this.color)},...z(["dashboardTheme"])},mounted(){this.isHex&&this.$nextTick(()=>{this.iro=new g.ColorPicker(this.$refs.iro,{width:200,color:this.color,layout:[{component:g.ui.Box,options:{}},{component:g.ui.Slider,options:{id:"hue-slider",sliderType:"hue"}},{component:g.ui.Slider,options:{sliderType:"alpha"}}]}),this.iro.on("color:change",t=>{this.color=t.hex8String})})},methods:{getColorByBgColor(t){return t.length===9&&(t=t.substring(0,7)),parseInt(t.replace("#",""),16)>16777215/2?"#000":"#fff"},toggle(){setTimeout(()=>this.showPicker=!0,25)},clickOutside(){let t=this.showPicker;setTimeout(()=>{t&&this.showPicker&&(this.showPicker=!1)},50)}},watch:{color(){this.onChange(this.color)}},components:{WebIcon:P}},Q={class:"name"},U={class:"v"},J={class:"icon"};function X(t,s,l,n,e,r){const a=T("web-icon"),u=S("click-outside"),p=S("tooltip");return d(),m("div",{class:R(["colorPicker",r.isHex?"hex":""])},[i("div",Q,_(l.name),1),i("div",{class:"value",onClick:s[1]||(s[1]=(...o)=>r.toggle&&r.toggle(...o)),style:b(r.isHex?{background:e.color,color:r.getColorByBgColor(e.color)}:{})},[r.isHex?(d(),m(f,{key:0},[i("div",U,_(e.color),1),i("div",J,[C(a,{icon:"fal fa-fw fa-pencil"})]),x(i("div",{class:"iro",ref:"iro",style:b({display:e.showPicker?"block":"none"})},null,4),[[u,r.clickOutside]])],64)):(d(),m(f,{key:1},[x(i("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=o=>e.color=o)},null,512),[[L,e.color]]),x(i("div",{class:"preview",style:b({background:e.color})},null,4),[[p,"Preview"]])],64))],4)],2)}const Y=W(M,[["render",X],["__scopeId","data-v-1c0ff0a5"]]);const K={data(){return{data:null,extendWeb:!1,extendDashboard:!1,webColors:null,dashboardColors:null,selected:"web",changes:[],webText:null,dashboardText:null,notificationSent:!1}},methods:{reset(){B.methods.open().then(t=>{window.axios.post("/admin/themes/reset",{target:this.selected}).then(()=>{t(),setTimeout(()=>this.$router.go(),1e3)}).catch(s=>E.methods.open(s.response.data.message.replaceAll(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,"")))})},compile(t="ui"){let s=t==="editor"?this[this.selected==="web"?"webText":"dashboardText"]:this.selected==="web"?this.data.web:this.data.dashboard;if(t==="ui"){const l=[];let n=null;s.replaceAll("\r","").split(`
`).forEach(e=>{const r=()=>{l.push(e)};if(!e.includes(":")||e.includes("{"))return r();const a=e.split(": ");let u=a[0].replaceAll(" ",""),p=a[1];p.endsWith(",")&&(p=p.substring(0,p.length-1));const o=p==="(";if(o&&(n=u),u==="$themes"||u==="name"||o)return r();let h=!1;this.changes.forEach(c=>{c.key===u&&c.group===n&&(l.push(a[0]+": "+c.value+","),h=!0)}),h||r()}),s=l.join(`
`)}B.methods.open().then(l=>{window.axios.post("/admin/themes/compile",{target:this.selected,text:s}).then(()=>{l(),setTimeout(()=>{this.selected==="dashboard"?window.location.reload():this.$bus.$emit("modal:close")},1e3)}).catch(n=>{this.$bus.$emit("modal:close"),E.methods.open(n.response.data.message.replaceAll(/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,""))})})},onChange(t,s,l){this.notificationSent||(this.notificationSent=!0,this.$bus.$emit("notifications:add",{type:"save",icon:"fas fa-fw fa-save",text:"Save the changes?",yes:()=>{this.compile("ui"),this.notificationSent=!1},no:()=>{this.notificationSent=!1}}));const n=this.changes.filter(e=>e.group===t&&e.key===s)[0];n?n.value=l:this.changes.push({group:t,key:s,value:l})},extractColors(t){let s=[],l=null;return t.replaceAll("\r","").split(`
`).forEach(n=>{if(!n.includes(":")||n.includes("{"))return;const e=n.split(": ");let r=e[0].replaceAll(" ",""),a=e[1];a.endsWith(",")&&(a=a.substring(0,a.length-1));const u=a==="(";u&&(l=r),!(r==="$themes"||r==="name"||u)&&s.push({group:l,key:r,value:a})}),s},getCmDoc(t){let s="";const l=(n,e)=>n.forEach((r,a)=>s+=r+(a===n.length-1&&e?"":`
`));return t.text?l(t.text,!0):t.children.forEach((n,e)=>l(n.text,e===t.children.length-1)),s},initEditor(t,s,l){let n=null;new A({state:$.create({doc:s,extensions:[V,F.of([N]),G(),H,O,A.updateListener.of(e=>{e.docChanged&&(n&&clearTimeout(n),n=setTimeout(()=>{n=null,this[l]=this.getCmDoc(e.state.doc)},50))})]}),parent:t})}},mounted(){q(()=>{window.axios.post("/admin/themes/data").then(({data:t})=>{this.data=t,this.$nextTick(()=>{this.initEditor(document.querySelector(".themes .web"),t.web,"webText"),this.initEditor(document.querySelector(".themes .dashboard"),t.dashboard,"dashboardText"),this.webColors=this.extractColors(t.web),this.dashboardColors=this.extractColors(t.dashboard)}),this.$bus.$emit("loading:done"),this.$bus.$emit("sidebarLoading:done")}),this.$bus.$on("themesSidebar:select",t=>this.selected=t)})},components:{ThemeColorPicker:Y,WebIcon:P}},y=t=>(Z("data-v-c1136e49"),t=t(),j(),t),ee={class:"pageTitle"},te={key:0,class:"themes animate"},se={class:"themeName"},oe=y(()=>i("hr",null,null,-1)),ie=y(()=>i("div",{class:"editor web"},null,-1)),ne=["disabled"],re={key:0},le={class:"themeName"},ae=y(()=>i("hr",null,null,-1)),ce=y(()=>i("div",{class:"editor dashboard"},null,-1)),de=["disabled"];function he(t,s,l,n,e,r){const a=T("theme-color-picker"),u=T("web-icon"),p=S("tooltip");return d(),m("div",null,[i("div",ee,[v(" Themes "),x(i("i",{class:"far fa-fw fa-undo-alt",onClick:s[0]||(s[0]=o=>r.reset())},null,512),[[p,"Reset"]])]),e.data?(d(),m("div",te,[i("div",{style:b({display:e.selected==="web"?"block":"none"})},[e.webColors?(d(!0),m(f,{key:0},k(new Set(e.webColors.map(o=>o.group)),o=>(d(),m(f,{key:o},[i("div",se,[v("Theme: "+_(o),1),i("div",null,"Theme: "+_(o),1)]),(d(!0),m(f,null,k(e.webColors.filter(h=>h.group===o),h=>(d(),D(a,{key:h.key+h.group,name:h.key,value:h.value,onChange:c=>this.onChange(h.group,h.key,c)},null,8,["name","value","onChange"]))),128))],64))),128)):w("",!0),oe,i("div",{class:"extend",onClick:s[1]||(s[1]=o=>e.extendWeb=!e.extendWeb)},[v(" Advanced configuration "),C(u,{icon:`fal ${e.extendWeb?"fa-chevron-down":"fa-chevron-right"}`},null,8,["icon"])]),i("div",{class:"advancedConfig",style:b({display:e.extendWeb?"block":"none"})},[ie,i("button",{class:"btn btn-primary",onClick:s[2]||(s[2]=o=>r.compile("editor")),disabled:e.webText===null},"Compile",8,ne)],4)],4),i("div",{style:b({display:e.selected==="dashboard"?"block":"none"})},[e.dashboardColors?(d(!0),m(f,{key:0},k(new Set(e.dashboardColors.map(o=>o.group)),(o,h)=>(d(),m(f,{key:o},[h>0?(d(),m("hr",re)):w("",!0),i("div",le,[v("Theme: "+_(o),1),i("div",null,"Theme: "+_(o),1)]),(d(!0),m(f,null,k(e.dashboardColors.filter(c=>c.group===o),c=>(d(),D(a,{key:c.key+c.group,name:c.key,value:c.value,onChange:I=>this.onChange(c.group,c.key,I)},null,8,["name","value","onChange"]))),128))],64))),128)):w("",!0),ae,i("div",{class:"extend",onClick:s[3]||(s[3]=o=>e.extendDashboard=!e.extendDashboard)},[v(" Advanced configuration "),C(u,{icon:`fal ${e.extendDashboard?"fa-chevron-down":"fa-chevron-right"}`},null,8,["icon"])]),i("div",{class:"advancedConfig",style:b({display:e.extendDashboard?"block":"none"})},[ce,i("button",{class:"btn btn-primary",onClick:s[4]||(s[4]=o=>r.compile("editor")),disabled:e.dashboardText===null},"Compile",8,de)],4)],4)])):w("",!0)])}const Oe=W(K,[["render",he],["__scopeId","data-v-c1136e49"]]);export{Oe as default};
