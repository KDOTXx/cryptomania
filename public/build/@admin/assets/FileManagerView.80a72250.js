import{_ as k,W as y}from"./app.f6b791b5.js";import{w as b}from"./pageSidebar.9e81cee6.js";import{f as l,A as r,I as p,g as d,x as c,z as w,v as _,F as f,i as D,Q as C,e as a,s as u,y as v,C as x,D as F,N as M,O as L,a3 as S}from"./@vue.ca773235.js";import"./vue.9ea8e8a6.js";import"./vuex.497f08d2.js";import"./overlayscrollbars.8d928870.js";import"./apexcharts.8dc8f2aa.js";import"./string-similarity.860833b6.js";import"./gsap.8449ad8c.js";import"./vue-router.63e2ccab.js";import"./vuex-persistedstate.fa252374.js";import"./izitoast.765d8918.js";import"./click-outside-vue3.6791b41e.js";import"./floating-vue.8db45bbf.js";import"./@floating-ui.9bdab495.js";import"./axios.ea6880df.js";import"./@vuepic.b319e7e5.js";import"./date-fns.5b6f9246.js";const I={data(){return{data:null,path:"",selected:null,isLoading:!1}},computed:{pathLower(){return this.path.substring(0,this.path.lastIndexOf("/"))}},methods:{upload(){const e=document.createElement("input");e.type="file",e.click(),e.onchange=()=>{let s=new FormData;s.append("file",e.files[0]),s.append("path",this.path),window.axios.post("/admin/fileManager/upload",s).then(()=>{this.reload(this.path)}).catch(()=>this.$toast.error("Failed to upload"))}},newDir(){const e=prompt("Directory name:");e&&window.axios.post("/admin/fileManager/newDir",{path:this.path+"/"+e}).then(()=>{this.reload(this.path)}).catch(()=>this.$toast.error("Failed to mkdir"))},deleteFile(){window.axios.post("/admin/fileManager/delete",{path:this.selected.path}).then(()=>{this.reload(this.path)}).catch(()=>this.$toast.error("Failed to delete"))},beginRename(){this.selected._renaming=!0,this.$nextTick(()=>document.querySelector("#r_"+this.selected.name.replace(/[^\w\s]/gi,"")).focus())},rename(e){this.selected._renaming=!1,window.axios.post("/admin/fileManager/rename",{path:this.selected.path,name:this.selected.dirPath+e}).then(()=>{this.reload(this.path)}).catch(()=>this.$toast.error("Failed to rename"))},download(){window.open("/admin/fileManager/download/"+this.selected.path,"_blank")},reload(e){this.isLoading=!0,window.axios.post("/admin/fileManager/list",{path:e}).then(({data:s})=>{this.selected=null,this.path=e,this.data=s,this.$bus.$emit("filesSidebar:setData",{path:this.path,data:this.data}),this.isLoading=!1}).catch(()=>{this.$toast.error("Failed to load directory"),this.isLoading=!1})},select(e,s=!1){if(!(this.selected&&this.selected._renaming)&&!this.isLoading){if(s||this.selected&&this.selected.path===e.path){e.isDir?this.reload(e.path):(this.download(),this.selected=null);return}this.selected=e}}},mounted(){b(()=>{window.axios.post("/admin/fileManager/list").then(({data:e})=>{this.data=e,this.$bus.$emit("filesSidebar:setData",{path:this.path,data:this.data}),this.$bus.$emit("loading:done"),this.$bus.$emit("sidebarLoading:done")}),this.$bus.$on("files:select",e=>this.select(e,!0))})},components:{WebIcon:y}},g=e=>(M("data-v-4d522fa0"),e=e(),L(),e),P={key:0,class:"fileManager animate"},N=g(()=>r("div",{class:"separator"},null,-1)),V={class:"preview"},B=g(()=>r("div",{class:"name"}," ... ",-1)),R=["onClick"],q={class:"preview"},z={key:0,class:"imagePreviewContainer"},E=["src"],K={class:"name"},O=["id","value"];function T(e,s,W,A,t,o){const n=C("web-icon"),h=S("tooltip");return t.data?(a(),l("div",P,[r("div",{class:c(["toolbar",e.$isDemo?"demoDisable":""])},[p(d(n,{icon:"fas fa-fw fa-upload",onClick:o.upload},null,8,["onClick"]),[[h,"Upload"]]),p(d(n,{icon:"fas fa-fw fa-download",class:c(!t.selected||t.selected.isDir||t.selected.isPrevious?"disabled":""),onClick:o.download},null,8,["class","onClick"]),[[h,"Download"]]),p(d(n,{icon:"fas fa-fw fa-i-cursor",class:c(!t.selected||t.selected.isPrevious?"disabled":""),onClick:s[0]||(s[0]=i=>o.beginRename())},null,8,["class"]),[[h,"Rename"]]),p(d(n,{icon:"fas fa-fw fa-trash",class:c(!t.selected||t.selected.isPrevious?"disabled":""),onClick:o.deleteFile},null,8,["class","onClick"]),[[h,"Delete"]]),N,p(d(n,{icon:"fas fa-fw fa-folder-plus",onClick:o.newDir},null,8,["onClick"]),[[h,"New directory"]])],2),r("div",{class:"files",onClick:s[5]||(s[5]=i=>t.selected=null)},[t.path!==""?(a(),l("div",{key:0,class:c(["file",t.selected&&t.selected.path===o.pathLower?"selected":""]),onClick:s[1]||(s[1]=w(i=>o.select({isDir:!0,path:o.pathLower,isPrevious:!0}),["stop"]))},[r("div",V,[d(n,{icon:"fas fa-fw fa-folder"})]),B],2)):_("",!0),(a(!0),l(f,null,D(t.data,i=>(a(),l("div",{class:c(["file",[t.selected&&t.selected.path===i.path?"selected":"",i.warn?"warn":""]]),key:i,onClick:w(m=>o.select(i),["stop"])},[r("div",q,[i.isDir?(a(),u(n,{key:0,icon:"fas fa-fw fa-folder"})):(a(),l(f,{key:1},[i.preview?(a(),l(f,{key:0},[i.preview.type==="image"?(a(),l("div",z,[r("img",{alt:"Preview",src:i.preview.content},null,8,E)])):(a(),u(n,{key:1,icon:"fas fa-fw fa-question-circle"}))],64)):(a(),u(n,{key:1,icon:"fas fa-fw fa-file"}))],64))]),r("div",K,[t.selected&&t.selected.path===i.path&&t.selected._renaming?(a(),l("input",{key:0,id:"r_"+t.selected.name.replace(/[^\w\s]/gi,""),type:"text",value:t.selected.name,onKeydown:[s[2]||(s[2]=v(m=>o.rename(m.target.value),["enter"])),s[3]||(s[3]=v(m=>t.selected._renaming=!1,["esc"]))],onBlur:s[4]||(s[4]=m=>t.selected._renaming=!1)},null,40,O)):(a(),l(f,{key:1},[x(F(i.name),1)],64))])],10,R))),128))])])):_("",!0)}const re=k(I,[["render",T],["__scopeId","data-v-4d522fa0"]]);export{re as default};
