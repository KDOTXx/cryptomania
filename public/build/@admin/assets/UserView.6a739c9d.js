import{O as h}from"./overlayscrollbars.8d928870.js";import{_ as w,W as f}from"./app.f6b791b5.js";import{w as x}from"./pageSidebar.9e81cee6.js";import{f as n,A as s,D as r,F as l,i as m,g as b,I as N,a4 as A,v as d,e as o,x as y,N as L,O as D,Q as S}from"./@vue.ca773235.js";import"./apexcharts.8dc8f2aa.js";import"./vue.9ea8e8a6.js";import"./vuex.497f08d2.js";import"./string-similarity.860833b6.js";import"./gsap.8449ad8c.js";import"./vue-router.63e2ccab.js";import"./vuex-persistedstate.fa252374.js";import"./izitoast.765d8918.js";import"./click-outside-vue3.6791b41e.js";import"./floating-vue.8db45bbf.js";import"./@floating-ui.9bdab495.js";import"./axios.ea6880df.js";import"./@vuepic.b319e7e5.js";import"./date-fns.5b6f9246.js";const I={data(){return{user:null,userAdvanced:null,transactions:[],page:0,isLoadingNextPage:!1,search:"",currencies:null}},methods:{changeBalance(t,a){window.axios.post("/admin/balance",{id:this.user.user._id,balance:a,currency:t}).catch(()=>this.$toast.error("Failed to save"))},isDone(){this.currencies&&this.user&&(this.$bus.$emit("loading:done"),this.$nextTick(()=>{h(document.querySelector(".user .entries.c"),{scrollbars:{autoHide:"leave"},className:"os-theme-thin-light"}),h(document.querySelector(".user .entries.tx"),{scrollbars:{autoHide:"leave"},className:"os-theme-thin-light"})}))},load(){this.isLoadingNextPage||(this.isLoadingNextPage=!0,window.axios.post("/admin/transactions/"+this.user.user._id+"/"+this.page).then(({data:t})=>{if(t.length===0){this.isLoadingNextPage=!0;return}this.isLoadingNextPage=!1,this.transactions=this.transactions.concat(t),this.page++}).catch(()=>this.isLoadingNextPage=!1))}},created(){x(()=>{window.axios.post("/api/data/currencies").then(({data:t})=>{this.currencies=t,this.isDone()}),window.axios.post("/admin/user",{id:this.$route.params.id}).then(({data:t})=>{this.user=t,this.load(),window.addEventListener("scroll",()=>{(()=>{let c=[document.scrollingElement.scrollHeight,document.body.scrollHeight,document.body.offsetHeight].sort(function(u,i){return i-u});return window.innerHeight+window.scrollY+2>=c[0]})()&&this.load()}),this.$bus.$emit("userSidebar:setData",t)}),window.axios.post("/admin/userAdvanced",{id:this.$route.params.id}).then(({data:t})=>{this.userAdvanced=t,this.isDone()})})},watch:{search(){this.search.length>=3?window.axios.post("/admin/transactionsSearch",{user:this.user.user._id,search:this.search}).then(({data:t})=>{this.page=0,this.transactions=t,this.isLoadingNextPage=!0}):(this.isLoadingNextPage=!1,this.load())}},components:{WebIcon:f}},p=t=>(L("data-v-40c96d5c"),t=t(),D(),t),P={class:"user"},W={class:"pageTitle"},k={key:0,class:"animate"},F={class:"entries c"},B=p(()=>s("div",{class:"h"},[s("div",null,"Currency"),s("div",null,"Games"),s("div",null,"Wins"),s("div",null,"Losses"),s("div",null,"Wagered"),s("div",null,"Balance")],-1)),H=["placeholder","value","onInput"],V={class:"search"},E={class:"entries tx"},T=p(()=>s("div",{class:"h"},[s("div",null,"Transaction"),s("div",null,"Data")],-1)),C={style:{"flex-direction":"column","padding-left":"5px"}};function U(t,a,c,u,i,v){const _=S("web-icon");return o(),n("div",P,[s("div",W,r(i.user?i.user.user.name:"User"),1),i.user&&i.currencies?(o(),n("div",k,[s("div",F,[B,(o(!0),n(l,null,m(i.currencies,e=>(o(),n(l,null,[i.userAdvanced.currencies[e.id]?(o(),n("div",{class:"entry",key:e},[s("div",null,r(e.name),1),s("div",null,r(i.userAdvanced?i.userAdvanced.currencies[e.id].games:"..."),1),s("div",null,r(i.userAdvanced?i.userAdvanced.currencies[e.id].wins:"..."),1),s("div",null,r(i.userAdvanced?i.userAdvanced.currencies[e.id].losses:"..."),1),s("div",null,r(i.userAdvanced?i.userAdvanced.currencies[e.id].wagered.toFixed(e.id.startsWith("local_")?2:8):"...")+" "+r(e.displayName),1),s("div",null,[t.$permission.checkPermission("users","edit")?(o(),n("input",{key:0,type:"text",placeholder:e.name,value:i.user.currencies[e.id].balance.toFixed(e.id.startsWith("local_")?2:8),onInput:g=>v.changeBalance(e.walletId,g.target.value),class:y(t.$isDemo?"demoDisable":"")},null,42,H)):d("",!0)])])):d("",!0)],64))),256))]),s("div",V,[b(_,{icon:"fal fa-fw fa-search"}),N(s("input",{type:"text",placeholder:"Transaction filter","onUpdate:modelValue":a[0]||(a[0]=e=>i.search=e)},null,512),[[A,i.search]])]),s("div",E,[T,(o(!0),n(l,null,m(i.transactions,e=>(o(),n(l,null,[i.currencies[e.currency]?(o(),n("div",{class:"entry",key:e},[s("div",C,[s("div",null,"Message: "+r(e.data.message?e.data.message:"-"),1),s("div",null,"Game: "+r(e.data.game?e.data.game:"-"),1),s("div",null," Amount: "+r(e.amount.toFixed(e.currency.startsWith("local_")?2:8))+" "+r(i.currencies[e.currency].name)+" (Before: "+r(e.old.toFixed(e.currency.startsWith("local_")?2:8))+", Now: "+r(e.new.toFixed(e.currency.startsWith("local_")?2:8))+") ",1)]),s("div",null,r(new Date(e.created_at).toLocaleString()),1)])):d("",!0)],64))),256))])])):d("",!0)])}const re=w(I,[["render",U],["__scopeId","data-v-40c96d5c"]]);export{re as default};
