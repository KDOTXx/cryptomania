import{_ as v,W as w}from"./app.f6b791b5.js";import{b as D}from"./codemirror.613ad510.js";import{z as g,E as C,p as k,A as S,B as y,C as x,D as I}from"./@codemirror.0312c085.js";import{w as N}from"./pageSidebar.9e81cee6.js";import{f as l,A as b,I as m,g as p,x as r,D as u,v as f,F as T,i as E,Q as $,e as n,N as j,O as V,a3 as O}from"./@vue.ca773235.js";import"./vue.9ea8e8a6.js";import"./vuex.497f08d2.js";import"./overlayscrollbars.8d928870.js";import"./apexcharts.8dc8f2aa.js";import"./string-similarity.860833b6.js";import"./gsap.8449ad8c.js";import"./vue-router.63e2ccab.js";import"./vuex-persistedstate.fa252374.js";import"./izitoast.765d8918.js";import"./click-outside-vue3.6791b41e.js";import"./floating-vue.8db45bbf.js";import"./@floating-ui.9bdab495.js";import"./axios.ea6880df.js";import"./@vuepic.b319e7e5.js";import"./date-fns.5b6f9246.js";import"./@lezer.5b9aa3da.js";import"./crelt.67277586.js";import"./style-mod.a2e40363.js";import"./w3c-keyname.30cf5eb3.js";const B={data(){return{data:null,selected:null,collection:null,page:null,pages:null}},watch:{selected(){!this.data||(this.page=1,this.pages=this.data.filter(e=>e.name===this.selected.name)[0].pages,this.loadCollection())}},methods:{remove(e){window.axios.post("/admin/database/deleteDocument/"+this.selected.name+"/"+e).then(()=>this.loadCollection())},loadCodeMirror(){this.$nextTick(()=>{this.collection.forEach((e,o)=>{const c=document.querySelector(`[data-cm-id="${o}"]`);new g({state:C.create({doc:JSON.stringify(e,null,2),extensions:[D,k.of([S]),y,x,I(),g.updateListener.of(i=>{window.$isDemo||i.docChanged&&(this.editorSaveDelayTimeout&&clearTimeout(this.editorSaveDelayTimeout),this.editorSaveDelayTimeout=setTimeout(()=>{this.editorSaveDelayTimeout=null;try{let t=JSON.parse(this.getCmDoc(i.state.doc));if(!t._id||!t._id.$oid){this.$toast.error("This document lacks ObjectID. It won't be saved.");return}const s=t._id.$oid;delete t._id,window.axios.post("/admin/database/saveDocument/"+this.selected.name+"/"+s,{object:t}).catch(()=>{this.$toast.error("Failed to save this document.")})}catch{this.$toast.error("Invalid JSON input.")}},500))})]}),parent:c})})})},loadCollection(){this.collection=null,window.axios.post("/admin/database/collection/"+this.selected.name+"/"+this.page).then(({data:e})=>{this.collection=e,this.loadCodeMirror()})},jump(){let e=prompt(`Enter page number (available pages: ${this.pages})`);if(!!e){if(e=parseInt(e),isNaN(e)||e>this.pages||e<1)return alert("Invalid page number.");this.page=e,this.loadCollection()}},getCmDoc(e){let o="";const c=(i,t)=>i.forEach((s,a)=>o+=s+(a===i.length-1&&t?"":`
`));return e.text?c(e.text,!0):e.children.forEach((i,t)=>c(i.text,t===e.children.length-1)),o}},mounted(){N(()=>{this.$bus.$on("db:select",e=>this.selected=e),window.axios.post("/admin/database/collections").then(({data:e})=>{this.data=e,this.$bus.$emit("dbSidebar:setData",e),this.$bus.$emit("loading:done"),this.$bus.$emit("sidebarLoading:done")})})},components:{WebIcon:w}},F=e=>(j("data-v-c55b354d"),e=e(),V(),e),J={key:0,class:"database animate"},L=F(()=>b("div",{class:"separator"},null,-1)),W={key:0,class:"right"},z={key:0,class:"content"},A=["data-cm-id"],M={class:"controls"},q=["onClick"];function G(e,o,c,i,t,s){const a=$("web-icon"),d=O("tooltip");return t.data?(n(),l("div",J,[b("div",{class:r(["toolbar",e.$isDemo?"demoDisable":""])},[m(p(a,{icon:"fal fa-fw fa-chevron-left",class:r(!t.collection||t.page<=1?"disabled":""),onClick:o[0]||(o[0]=h=>{t.page--,s.loadCollection()})},null,8,["class"]),[[d,"Previous page"]]),m(p(a,{icon:"fal fa-fw fa-chevron-right",class:r(!t.collection||t.page>=t.pages?"disabled":""),onClick:o[1]||(o[1]=h=>{t.page++,s.loadCollection()})},null,8,["class"]),[[d,"Next page"]]),m(p(a,{icon:"fal fa-fw fa-chevron-double-right",onClick:s.jump,class:r(t.collection?"":"disabled")},null,8,["onClick","class"]),[[d,"Go to..."]]),L,t.collection?(n(),l("div",W,u(t.selected.name)+" ("+u(t.page)+" / "+u(t.pages)+") ",1)):f("",!0)],2),t.collection?(n(),l("div",z,[(n(!0),l(T,null,E(t.collection,(h,_)=>(n(),l("div",{class:"cm","data-cm-id":_,key:_},[b("div",M,[m((n(),l("div",{onClick:P=>s.remove(h._id.$oid),class:r(e.$isDemo?"demoDisable":"")},[p(a,{icon:"fal fa-times"})],10,q)),[[d,"Remove this document"]])])],8,A))),128))])):f("",!0)])):f("",!0)}const be=v(B,[["render",G],["__scopeId","data-v-c55b354d"]]);export{be as default};
