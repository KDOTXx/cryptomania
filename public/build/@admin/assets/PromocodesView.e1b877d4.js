import{O as b}from"./overlayscrollbars.8d928870.js";import{_ as k,W as D}from"./app.f6b791b5.js";import{D as g}from"./DashboardDropdownConfig.00aa5cf0.js";import{f as r,A as t,v as c,F as p,C as a,i as C,s as x,j as S,x as f,g as v,Q as y,e as o,D as d,N,O as U}from"./@vue.ca773235.js";import"./apexcharts.8dc8f2aa.js";import"./vue.9ea8e8a6.js";import"./vuex.497f08d2.js";import"./string-similarity.860833b6.js";import"./gsap.8449ad8c.js";import"./vue-router.63e2ccab.js";import"./vuex-persistedstate.fa252374.js";import"./izitoast.765d8918.js";import"./click-outside-vue3.6791b41e.js";import"./floating-vue.8db45bbf.js";import"./@floating-ui.9bdab495.js";import"./axios.ea6880df.js";import"./@vuepic.b319e7e5.js";import"./date-fns.5b6f9246.js";import"./DashboardSwitch.dc169bb3.js";const I={data(){return{promocodes:null,currencies:null,isUnlimited:!1,isRandom:!1,code:"Code",uses:"50",sum:"0",currency:null,expires:new Date(Date.now()+3600*1e3*24)}},components:{WebIcon:D,DashboardDropdownConfig:g},methods:{remove(s){this.promocodes=this.promocodes.filter(l=>l._id!==s),window.axios.post("/admin/promocode/remove",{id:s})},cleanup(){window.axios.post("/admin/promocode/remove_inactive").then(()=>{this.$toast.success("Done"),this.load()})},create(){window.axios.post("/admin/promocode/create",{code:this.isRandom?"%random%":this.code,usages:this.isUnlimited?"%infinite%":parseInt(this.uses),expires:new Date(this.expires).getTime()/1e3,sum:parseFloat(this.sum),currency:this.currency}).then(()=>this.load()).catch(()=>this.$toast.error("Error"))},load(s=!1){window.axios.post("/admin/promocode/get").then(({data:l})=>{this.promocodes=l,s&&(this.$bus.$emit("loading:done"),this.$nextTick(()=>{b(document.querySelector(".promocodes .entries"),{scrollbars:{autoHide:"leave"},className:"os-theme-thin-light"})}))})}},created(){this.load(!0),window.axios.post("/api/data/currencies").then(({data:s})=>{this.currencies=s,this.currency=Object.keys(this.currencies)[0]})}},u=s=>(N("data-v-d539ecee"),s=s(),U(),s),P={key:0,class:"promocodes animate"},V={class:"entries"},O={class:"h"},B=u(()=>t("div",null,"Code",-1)),E=u(()=>t("div",null,"Amount",-1)),F=u(()=>t("div",null,"Usages",-1)),R=u(()=>t("div",null,"Expiration",-1)),j=u(()=>t("div",null,"Created",-1)),A={key:0},L={key:0},T=["onClick"],W={class:"buttons"};function $(s,l,q,z,i,m){const h=y("web-icon"),w=y("dashboard-dropdown-config");return i.promocodes?(o(),r("div",P,[t("div",V,[t("div",O,[B,E,F,R,j,s.$permission.checkPermission("promocodes","delete")?(o(),r("div",A,"Actions")):c("",!0)]),i.promocodes.length===0?(o(),r(p,{key:0},[a(" No data to show. ")],64)):c("",!0),(o(!0),r(p,null,C(i.promocodes,e=>(o(),r("div",{class:"entry",key:e},[t("div",null,d(e.code),1),t("div",null,[a(d(e.sum.toFixed(e.currency.startsWith("local_")?2:8))+" ",1),i.currencies?(o(),r(p,{key:0},[a(d(i.currencies[i.currency].name),1)],64)):c("",!0)]),t("div",null,[a(d(e.times_used),1),e.usages>=0?(o(),r(p,{key:0},[a("/"+d(e.usages),1)],64)):c("",!0)]),t("div",null,d(+new Date(e.expires)==-62135596800?"Never":new Date(e.expires).toLocaleString()),1),t("div",null,d(new Date(e.created_at).toLocaleString()),1),s.$permission.checkPermission("promocodes","delete")?(o(),r("div",L,[t("button",{class:f(["btn btn-primary",s.$isDemo?"demoDisable":""]),onClick:n=>m.remove(e._id)},[v(h,{icon:"fal fa-fw fa-times"}),a(" Delete ")],10,T)])):c("",!0)]))),128))]),t("div",W,[s.$permission.checkPermission("promocodes","create")&&i.currencies?(o(),x(w,{key:0,values:[{type:"switch",title:"Unlimited",event:(e,n)=>{this.isUnlimited=e,e?n.disabled.push("Uses"):n.disabled=n.disabled.filter(_=>_!=="Uses")}},{type:"switch",title:"Random code",event:(e,n)=>{this.isRandom=e,e?n.disabled.push("Code"):n.disabled=n.disabled.filter(_=>_!=="Code")}},{type:"input",title:"Code",value:this.code,event:e=>{this.code=e}},{type:"input",title:"Uses",value:this.uses,event:e=>{this.uses=e}},{type:"input",title:"Sum",value:this.sum,event:e=>{this.sum=e}},{type:"select",title:"Currency",value:this.currency,values:Object.keys(i.currencies).map(e=>[i.currencies[e].id,i.currencies[e].name]),event:e=>{this.currency=e}},{type:"datepicker",value:i.expires,title:"Expires",event:e=>{this.expires=new Date(e)}},{type:"button",disabled:s.$isDemo,title:"Create",event:e=>{e.show=!1,m.create()}}]},{default:S(()=>[v(h,{icon:"fal fa-fw fa-plus"}),a(" Create ")]),_:1},8,["values"])):c("",!0),s.$permission.checkPermission("promocodes","delete")?(o(),r("button",{key:1,class:f(["btn",s.$isDemo?"demoDisable":""]),onClick:l[0]||(l[0]=(...e)=>m.cleanup&&m.cleanup(...e))},[v(h,{icon:"fal fa-fw fa-times"}),a(" Delete expired")],2)):c("",!0)])])):c("",!0)}const le=k(I,[["render",$],["__scopeId","data-v-d539ecee"]]);export{le as default};
